<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼íƒœ ê´€ë¦¬ ì•±</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8; /* ë°ì€ íšŒìƒ‰ ë°°ê²½ */
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 30px; /* ìƒë‹¨ ì—¬ë°± ì¶”ê°€ */
            max-width: 480px;
            width: 100%;
            box-sizing: border-box;
            position: relative; /* ìƒëŒ€ ìœ„ì¹˜ ì§€ì • */
        }
        h1 {
            color: #1a202c;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }
        input[type="time"],
        input[type="number"],
        select,
        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        input[type="time"]:focus,
        input[type="number"]:focus,
        select:focus,
        button:focus {
            outline: none;
            border-color: #6366f1; /* ë³´ë¼ìƒ‰ ê°•ì¡° */
        }
        button {
            background-color: #6366f1; /* ë³´ë¼ìƒ‰ ë²„íŠ¼ */
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:hover {
            background-color: #5a5ceb;
            transform: translateY(-1px);
        }
        .results {
            background-color: #edf2f7; /* ë°ì€ íšŒìƒ‰ ë°°ê²½ */
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid #e2e8f0;
        }
        .results p {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #2d3748;
        }
        .results p strong {
            color: #2c5282; /* ì§„í•œ íŒŒë€ìƒ‰ */
        }
        .current-month-info {
            text-align: center;
            margin-top: 20px;
            font-size: 1.1rem;
            color: #4a5568;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .calendar-day {
            background-color: #e2e8f0;
            border-radius: 6px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }
        .calendar-day.selected {
            background-color: #6366f1; /* ì„ íƒëœ ë‚ ì§œ ë³´ë¼ìƒ‰ */
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }
        .calendar-day.today {
            border: 2px solid #3182ce; /* ì˜¤ëŠ˜ ë‚ ì§œ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
        }
        .calendar-day:hover {
            background-color: #cfd8e3;
            transform: translateY(-1px);
        }
        .calendar-day.selected:hover {
            background-color: #5a5ceb;
        }
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        .month-selector button {
            background-color: #a7a9ff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 1.2rem;
            width: auto;
            margin-bottom: 0;
        }
        .month-selector button:hover {
            background-color: #8f92f5;
        }
        .month-selector span {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
        }
        .day-name {
            text-align: center;
            font-weight: 700;
            color: #4a5568;
            padding: 5px 0;
        }
        .day-off {
            background-color: #fbd38d; /* ì£¼í™©ìƒ‰ */
            color: #7b341e;
        }
        .current-month-total {
            background-color: #e0f2fe; /* í•˜ëŠ˜ìƒ‰ */
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s;
        }
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 15px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .modal-buttons button {
            flex: 1;
            margin: 0 5px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .modal-buttons .save-btn {
            background-color: #48bb78; /* ë…¹ìƒ‰ */
        }
        .modal-buttons .save-btn:hover {
            background-color: #38a169;
        }
        .modal-buttons .delete-btn {
            background-color: #e53e3e; /* ë¹¨ê°„ìƒ‰ */
        }
        .modal-buttons .delete-btn:hover {
            background-color: #c53030;
        }
        .modal-buttons .cancel-btn {
            background-color: #a0aec0; /* íšŒìƒ‰ */
        }
        .modal-buttons .cancel-btn:hover {
            background-color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—“ï¸ ê·¼íƒœ ê´€ë¦¬</h1>

        <div class="month-selector">
            <button id="prevMonthBtn">&lt;</button>
            <span id="currentMonthYear"></span>
            <button id="nextMonthBtn">&gt;</button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
            <div class="day-name">ì¼</div>
            <div class="day-name">ì›”</div>
            <div class="day-name">í™”</div>
            <div class="day-name">ìˆ˜</div>
            <div class="day-name">ëª©</div>
            <div class="day-name">ê¸ˆ</div>
            <div class="day-name">í† </div>
            </div>

        <div class="current-month-total">
            <p>ì´ë²ˆ ë‹¬ ì´ ì˜ˆìƒ ê·¼ë¬´ì‹œê°„: <span id="totalMonthlyHours">0</span>ì‹œê°„</p>
            <p>ì´ë²ˆ ë‹¬ ì´ ì˜ˆìƒ ìˆ˜ë‹¹: <span id="totalMonthlyWage">0</span>ì›</p>
        </div>

        <div id="timeModal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2 class="text-xl font-bold mb-4 text-center" id="modalDate"></h2>

                <label for="modalArrivalTime">ì¶œê·¼ ì‹œê°„:</label>
                <input type="time" id="modalArrivalTime" value="09:00" step="60"> <label for="modalDepartureTime">í‡´ê·¼ ì‹œê°„:</label>
                <input type="time" id="modalDepartureTime" value="18:00" step="60"> <label for="modalHourlyWage">ì‹œê°„ë‹¹ ê¸‰ì—¬ (ì›):</label>
                <input type="number" id="modalHourlyWage" value="9860" min="0">

                <div class="modal-buttons">
                    <button id="saveTimeBtn" class="save-btn">ì €ì¥</button>
                    <button id="deleteTimeBtn" class="delete-btn">ì‚­ì œ</button>
                    <button id="cancelTimeBtn" class="cancel-btn">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const currentMonthYearSpan = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const calendarGrid = document.getElementById('calendarGrid');
        const totalMonthlyHoursSpan = document.getElementById('totalMonthlyHours');
        const totalMonthlyWageSpan = document.getElementById('totalMonthlyWage');

        const timeModal = document.getElementById('timeModal');
        const closeButton = document.querySelector('.close-button');
        const modalDate = document.getElementById('modalDate');
        const modalArrivalTime = document.getElementById('modalArrivalTime');
        const modalDepartureTime = document.getElementById('modalDepartureTime');
        const modalHourlyWage = document.getElementById('modalHourlyWage');
        const saveTimeBtn = document.getElementById('saveTimeBtn');
        const deleteTimeBtn = document.getElementById('deleteTimeBtn');
        const cancelTimeBtn = document.getElementById('cancelTimeBtn');

        let currentYear, currentMonth;
        let selectedDateElement = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ DOM ìš”ì†Œ
        let selectedDate = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ (Date ê°ì²´)

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
        const loadAttendanceData = () => {
            const data = localStorage.getItem('attendanceData');
            return data ? JSON.parse(data) : {};
        };

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
        const saveAttendanceData = (data) => {
            localStorage.setItem('attendanceData', JSON.stringify(data));
        };

        let attendanceData = loadAttendanceData();

        const renderCalendar = (year, month) => {
            currentMonthYearSpan.textContent = `${year}ë…„ ${month + 1}ì›”`;
            calendarGrid.innerHTML = `
                <div class="day-name">ì¼</div>
                <div class="day-name">ì›”</div>
                <div class="day-name">í™”</div>
                <div class="day-name">ìˆ˜</div>
                <div class="day-name">ëª©</div>
                <div class="day-name">ê¸ˆ</div>
                <div class="day-name">í† </div>
            `;

            const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0:ì¼, 1:ì›”, ..., 6:í† 
            const daysInMonth = new Date(year, month + 1, 0).getDate(); // í•´ë‹¹ ì›”ì˜ ì´ ì¼ìˆ˜

            // ë‹¬ë ¥ ì‹œì‘ ìš”ì¼ê¹Œì§€ ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarGrid.innerHTML += `<div class="calendar-day empty"></div>`;
            }

            const today = new Date();
            const todayYear = today.getFullYear();
            const todayMonth = today.getMonth();
            const todayDate = today.getDate();

            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let date = 1; date <= daysInMonth; date++) {
                const dayOfWeek = new Date(year, month, date).getDay();
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const entry = attendanceData[dateKey];

                let dayClass = 'calendar-day';
                if (year === todayYear && month === todayMonth && date === todayDate) {
                    dayClass += ' today';
                }
                if (dayOfWeek === 0 || dayOfWeek === 6) { // ì¼ìš”ì¼ ë˜ëŠ” í† ìš”ì¼
                    dayClass += ' day-off';
                }
                if (entry) {
                    dayClass += ' selected'; // ë°ì´í„°ê°€ ìˆëŠ” ë‚ ì§œëŠ” ì„ íƒëœ ê²ƒì²˜ëŸ¼ í‘œì‹œ
                }

                calendarGrid.innerHTML += `<div class="${dayClass}" data-date="${dateKey}">${date}</div>`;
            }

            attachDayClickHandlers();
            calculateMonthlyTotals();
        };

        const attachDayClickHandlers = () => {
            document.querySelectorAll('.calendar-day:not(.empty)').forEach(dayElement => {
                dayElement.addEventListener('click', () => {
                    if (selectedDateElement) {
                        selectedDateElement.classList.remove('selected');
                    }
                    selectedDateElement = dayElement;
                    dayElement.classList.add('selected');

                    const dateKey = dayElement.dataset.date;
                    selectedDate = new Date(dateKey); // Date ê°ì²´ë¡œ ì €ì¥

                    const entry = attendanceData[dateKey];
                    modalDate.textContent = `${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼`;

                    if (entry) {
                        modalArrivalTime.value = entry.arrivalTime;
                        modalDepartureTime.value = entry.departureTime;
                        modalHourlyWage.value = entry.hourlyWage;
                        deleteTimeBtn.style.display = 'block'; // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
                    } else {
                        // ê¸°ë³¸ê°’ ë˜ëŠ” ë¹„ì›Œë‘ê¸°
                        modalArrivalTime.value = '09:00';
                        modalDepartureTime.value = '18:00';
                        modalHourlyWage.value = '9860'; // ìµœì €ì‹œê¸‰ ê¸°ë³¸ê°’
                        deleteTimeBtn.style.display = 'none'; // ë°ì´í„° ì—†ìœ¼ë©´ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€
                    }
                    timeModal.style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
                });
            });
        };

        const calculateTimeDifference = (start, end) => {
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);

            const startDate = new Date(0, 0, 0, startH, startM, 0);
            const endDate = new Date(0, 0, 0, endH, endM, 0);

            // í‡´ê·¼ ì‹œê°„ì´ ë‹¤ìŒ ë‚ ì¸ ê²½ìš° (ì˜ˆ: 23:00 -> 02:00)
            if (endDate < startDate) {
                endDate.setDate(endDate.getDate() + 1);
            }

            const diffMs = endDate - startDate; // ë°€ë¦¬ì´ˆ ì°¨ì´
            const diffHours = diffMs / (1000 * 60 * 60); // ì‹œê°„ìœ¼ë¡œ ë³€í™˜
            return diffHours;
        };

        const calculateMonthlyTotals = () => {
            let totalHours = 0;
            let totalWage = 0;

            for (const dateKey in attendanceData) {
                const [year, month, day] = dateKey.split('-').map(Number);
                if (year === currentYear && month === currentMonth + 1) { // í˜„ì¬ ì›”ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ ê³„ì‚°
                    const entry = attendanceData[dateKey];
                    const hours = calculateTimeDifference(entry.arrivalTime, entry.departureTime);
                    totalHours += hours;
                    totalWage += hours * entry.hourlyWage;
                }
            }
            totalMonthlyHoursSpan.textContent = totalHours.toFixed(1); // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€
            totalMonthlyWageSpan.textContent = Math.round(totalWage).toLocaleString(); // ë°˜ì˜¬ë¦¼ í›„ ì²œë‹¨ìœ„ ì½¤ë§ˆ
        };

        // ì´ˆê¸° ë‹¬ë ¥ ë Œë”ë§
        const initializeCalendar = () => {
            const now = new Date();
            currentYear = now.getFullYear();
            currentMonth = now.getMonth();
            renderCalendar(currentYear, currentMonth);
        };

        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        closeButton.addEventListener('click', () => {
            timeModal.style.display = 'none';
        });

        cancelTimeBtn.addEventListener('click', () => {
            timeModal.style.display = 'none';
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', (event) => {
            if (event.target === timeModal) {
                timeModal.style.display = 'none';
            }
        });

        // ì €ì¥ ë²„íŠ¼
        saveTimeBtn.addEventListener('click', () => {
            const dateKey = selectedDateElement.dataset.date;
            attendanceData[dateKey] = {
                arrivalTime: modalArrivalTime.value,
                departureTime: modalDepartureTime.value,
                hourlyWage: parseFloat(modalHourlyWage.value)
            };
            saveAttendanceData(attendanceData);
            timeModal.style.display = 'none';
            // ë‹¬ë ¥ì— ì„ íƒ í‘œì‹œí•˜ê³ , ì´ê³„ ë‹¤ì‹œ ê³„ì‚°
            if (selectedDateElement && !selectedDateElement.classList.contains('selected')) {
                 selectedDateElement.classList.add('selected');
            }
            calculateMonthlyTotals();
        });

        // ì‚­ì œ ë²„íŠ¼
        deleteTimeBtn.addEventListener('click', () => {
            const dateKey = selectedDateElement.dataset.date;
            delete attendanceData[dateKey];
            saveAttendanceData(attendanceData);
            timeModal.style.display = 'none';
            // ë‹¬ë ¥ì—ì„œ ì„ íƒ í‘œì‹œ ì œê±°í•˜ê³ , ì´ê³„ ë‹¤ì‹œ ê³„ì‚°
            if (selectedDateElement && selectedDateElement.classList.contains('selected')) {
                 selectedDateElement.classList.remove('selected');
            }
            calculateMonthlyTotals();
        });

        // ì´ì „/ë‹¤ìŒ ë‹¬ ë²„íŠ¼
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentYear, currentMonth);
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentYear, currentMonth);
        });

        initializeCalendar();
    </script>
</body>
</html>
