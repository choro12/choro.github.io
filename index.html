<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>근태 관리 앱</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8; /* 밝은 회색 배경 */
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 상단 정렬 */
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 30px; /* 상단 여백 추가 */
            max-width: 480px;
            width: 100%;
            box-sizing: border-box;
            position: relative; /* 상대 위치 지정 */
        }
        h1 {
            color: #1a202c;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }
        input[type="time"],
        input[type="number"],
        select,
        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        input[type="time"]:focus,
        input[type="number"]:focus,
        select:focus,
        button:focus {
            outline: none;
            border-color: #6366f1; /* 보라색 강조 */
        }
        button {
            background-color: #6366f1; /* 보라색 버튼 */
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:hover {
            background-color: #5a5ceb;
            transform: translateY(-1px);
        }
        .results {
            background-color: #edf2f7; /* 밝은 회색 배경 */
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid #e2e8f0;
        }
        .results p {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #2d3748;
        }
        .results p strong {
            color: #2c5282; /* 진한 파란색 */
        }
        .current-month-info {
            text-align: center;
            margin-top: 20px;
            font-size: 1.1rem;
            color: #4a5568;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .calendar-day {
            background-color: #e2e8f0;
            border-radius: 6px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }
        .calendar-day.selected {
            background-color: #6366f1; /* 선택된 날짜 보라색 */
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }
        .calendar-day.today {
            border: 2px solid #3182ce; /* 오늘 날짜 파란색 테두리 */
        }
        .calendar-day:hover {
            background-color: #cfd8e3;
            transform: translateY(-1px);
        }
        .calendar-day.selected:hover {
            background-color: #5a5ceb;
        }
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        .month-selector button {
            background-color: #a7a9ff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 1.2rem;
            width: auto;
            margin-bottom: 0;
        }
        .month-selector button:hover {
            background-color: #8f92f5;
        }
        .month-selector span {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
        }
        .day-name {
            text-align: center;
            font-weight: 700;
            color: #4a5568;
            padding: 5px 0;
        }
        .day-off {
            background-color: #fbd38d; /* 주황색 */
            color: #7b341e;
        }
        .current-month-total {
            background-color: #e0f2fe; /* 하늘색 */
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s;
        }
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 15px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .modal-buttons button {
            flex: 1;
            margin: 0 5px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .modal-buttons .save-btn {
            background-color: #48bb78; /* 녹색 */
        }
        .modal-buttons .save-btn:hover {
            background-color: #38a169;
        }
        .modal-buttons .delete-btn {
            background-color: #e53e3e; /* 빨간색 */
        }
        .modal-buttons .delete-btn:hover {
            background-color: #c53030;
        }
        .modal-buttons .cancel-btn {
            background-color: #a0aec0; /* 회색 */
        }
        .modal-buttons .cancel-btn:hover {
            background-color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗓️ 근태 관리</h1>

        <div class="month-selector">
            <button id="prevMonthBtn">&lt;</button>
            <span id="currentMonthYear"></span>
            <button id="nextMonthBtn">&gt;</button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
            <div class="day-name">일</div>
            <div class="day-name">월</div>
            <div class="day-name">화</div>
            <div class="day-name">수</div>
            <div class="day-name">목</div>
            <div class="day-name">금</div>
            <div class="day-name">토</div>
            </div>

        <div class="current-month-total">
            <p>이번 달 총 예상 근무시간: <span id="totalMonthlyHours">0</span>시간</p>
            <p>이번 달 총 예상 수당: <span id="totalMonthlyWage">0</span>원</p>
        </div>

        <div id="timeModal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2 class="text-xl font-bold mb-4 text-center" id="modalDate"></h2>

                <label for="modalArrivalTime">출근 시간:</label>
                <input type="time" id="modalArrivalTime" value="09:00" step="60"> <label for="modalDepartureTime">퇴근 시간:</label>
                <input type="time" id="modalDepartureTime" value="18:00" step="60"> <label for="modalHourlyWage">시간당 급여 (원):</label>
                <input type="number" id="modalHourlyWage" value="9860" min="0">

                <div class="modal-buttons">
                    <button id="saveTimeBtn" class="save-btn">저장</button>
                    <button id="deleteTimeBtn" class="delete-btn">삭제</button>
                    <button id="cancelTimeBtn" class="cancel-btn">취소</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const currentMonthYearSpan = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const calendarGrid = document.getElementById('calendarGrid');
        const totalMonthlyHoursSpan = document.getElementById('totalMonthlyHours');
        const totalMonthlyWageSpan = document.getElementById('totalMonthlyWage');

        const timeModal = document.getElementById('timeModal');
        const closeButton = document.querySelector('.close-button');
        const modalDate = document.getElementById('modalDate');
        const modalArrivalTime = document.getElementById('modalArrivalTime');
        const modalDepartureTime = document.getElementById('modalDepartureTime');
        const modalHourlyWage = document.getElementById('modalHourlyWage');
        const saveTimeBtn = document.getElementById('saveTimeBtn');
        const deleteTimeBtn = document.getElementById('deleteTimeBtn');
        const cancelTimeBtn = document.getElementById('cancelTimeBtn');

        let currentYear, currentMonth;
        let selectedDateElement = null; // 현재 선택된 날짜 DOM 요소
        let selectedDate = null; // 현재 선택된 날짜 (Date 객체)

        // 로컬 스토리지에서 데이터 로드
        const loadAttendanceData = () => {
            const data = localStorage.getItem('attendanceData');
            return data ? JSON.parse(data) : {};
        };

        // 로컬 스토리지에 데이터 저장
        const saveAttendanceData = (data) => {
            localStorage.setItem('attendanceData', JSON.stringify(data));
        };

        let attendanceData = loadAttendanceData();

        const renderCalendar = (year, month) => {
            currentMonthYearSpan.textContent = `${year}년 ${month + 1}월`;
            calendarGrid.innerHTML = `
                <div class="day-name">일</div>
                <div class="day-name">월</div>
                <div class="day-name">화</div>
                <div class="day-name">수</div>
                <div class="day-name">목</div>
                <div class="day-name">금</div>
                <div class="day-name">토</div>
            `;

            const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0:일, 1:월, ..., 6:토
            const daysInMonth = new Date(year, month + 1, 0).getDate(); // 해당 월의 총 일수

            // 달력 시작 요일까지 빈 칸 채우기
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarGrid.innerHTML += `<div class="calendar-day empty"></div>`;
            }

            const today = new Date();
            const todayYear = today.getFullYear();
            const todayMonth = today.getMonth();
            const todayDate = today.getDate();

            // 날짜 채우기
            for (let date = 1; date <= daysInMonth; date++) {
                const dayOfWeek = new Date(year, month, date).getDay();
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const entry = attendanceData[dateKey];

                let dayClass = 'calendar-day';
                if (year === todayYear && month === todayMonth && date === todayDate) {
                    dayClass += ' today';
                }
                if (dayOfWeek === 0 || dayOfWeek === 6) { // 일요일 또는 토요일
                    dayClass += ' day-off';
                }
                if (entry) {
                    dayClass += ' selected'; // 데이터가 있는 날짜는 선택된 것처럼 표시
                }

                calendarGrid.innerHTML += `<div class="${dayClass}" data-date="${dateKey}">${date}</div>`;
            }

            attachDayClickHandlers();
            calculateMonthlyTotals();
        };

        const attachDayClickHandlers = () => {
            document.querySelectorAll('.calendar-day:not(.empty)').forEach(dayElement => {
                dayElement.addEventListener('click', () => {
                    if (selectedDateElement) {
                        selectedDateElement.classList.remove('selected');
                    }
                    selectedDateElement = dayElement;
                    dayElement.classList.add('selected');

                    const dateKey = dayElement.dataset.date;
                    selectedDate = new Date(dateKey); // Date 객체로 저장

                    const entry = attendanceData[dateKey];
                    modalDate.textContent = `${selectedDate.getFullYear()}년 ${selectedDate.getMonth() + 1}월 ${selectedDate.getDate()}일`;

                    if (entry) {
                        modalArrivalTime.value = entry.arrivalTime;
                        modalDepartureTime.value = entry.departureTime;
                        modalHourlyWage.value = entry.hourlyWage;
                        deleteTimeBtn.style.display = 'block'; // 데이터가 있으면 삭제 버튼 표시
                    } else {
                        // 기본값 또는 비워두기
                        modalArrivalTime.value = '09:00';
                        modalDepartureTime.value = '18:00';
                        modalHourlyWage.value = '9860'; // 최저시급 기본값
                        deleteTimeBtn.style.display = 'none'; // 데이터 없으면 삭제 버튼 숨김
                    }
                    timeModal.style.display = 'flex'; // 모달 표시
                });
            });
        };

        const calculateTimeDifference = (start, end) => {
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);

            const startDate = new Date(0, 0, 0, startH, startM, 0);
            const endDate = new Date(0, 0, 0, endH, endM, 0);

            // 퇴근 시간이 다음 날인 경우 (예: 23:00 -> 02:00)
            if (endDate < startDate) {
                endDate.setDate(endDate.getDate() + 1);
            }

            const diffMs = endDate - startDate; // 밀리초 차이
            const diffHours = diffMs / (1000 * 60 * 60); // 시간으로 변환
            return diffHours;
        };

        const calculateMonthlyTotals = () => {
            let totalHours = 0;
            let totalWage = 0;

            for (const dateKey in attendanceData) {
                const [year, month, day] = dateKey.split('-').map(Number);
                if (year === currentYear && month === currentMonth + 1) { // 현재 월에 해당하는 데이터만 계산
                    const entry = attendanceData[dateKey];
                    const hours = calculateTimeDifference(entry.arrivalTime, entry.departureTime);
                    totalHours += hours;
                    totalWage += hours * entry.hourlyWage;
                }
            }
            totalMonthlyHoursSpan.textContent = totalHours.toFixed(1); // 소수점 첫째 자리까지
            totalMonthlyWageSpan.textContent = Math.round(totalWage).toLocaleString(); // 반올림 후 천단위 콤마
        };

        // 초기 달력 렌더링
        const initializeCalendar = () => {
            const now = new Date();
            currentYear = now.getFullYear();
            currentMonth = now.getMonth();
            renderCalendar(currentYear, currentMonth);
        };

        // 모달 닫기 버튼
        closeButton.addEventListener('click', () => {
            timeModal.style.display = 'none';
        });

        cancelTimeBtn.addEventListener('click', () => {
            timeModal.style.display = 'none';
        });

        // 모달 외부 클릭 시 닫기
        window.addEventListener('click', (event) => {
            if (event.target === timeModal) {
                timeModal.style.display = 'none';
            }
        });

        // 저장 버튼
        saveTimeBtn.addEventListener('click', () => {
            const dateKey = selectedDateElement.dataset.date;
            attendanceData[dateKey] = {
                arrivalTime: modalArrivalTime.value,
                departureTime: modalDepartureTime.value,
                hourlyWage: parseFloat(modalHourlyWage.value)
            };
            saveAttendanceData(attendanceData);
            timeModal.style.display = 'none';
            // 달력에 선택 표시하고, 총계 다시 계산
            if (selectedDateElement && !selectedDateElement.classList.contains('selected')) {
                 selectedDateElement.classList.add('selected');
            }
            calculateMonthlyTotals();
        });

        // 삭제 버튼
        deleteTimeBtn.addEventListener('click', () => {
            const dateKey = selectedDateElement.dataset.date;
            delete attendanceData[dateKey];
            saveAttendanceData(attendanceData);
            timeModal.style.display = 'none';
            // 달력에서 선택 표시 제거하고, 총계 다시 계산
            if (selectedDateElement && selectedDateElement.classList.contains('selected')) {
                 selectedDateElement.classList.remove('selected');
            }
            calculateMonthlyTotals();
        });

        // 이전/다음 달 버튼
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentYear, currentMonth);
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentYear, currentMonth);
        });

        initializeCalendar();
    </script>
</body>
</html>
